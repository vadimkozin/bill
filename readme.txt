# Телефонный биллинг
1) Установить Docker Desktop (https://docs.docker.com/desktop/)
2) Скачать bill.zip
3) Разархивировать bill.zip в удобном месте
 из архива получим: /cfg/cfg.py, /cfg/ini.py и run.sh

/cfg/cfg.py - файл с параметрами (подключение к БД, пути и пр.)
/cfg/ini.py - файл с текущим расчётным месяцем и годом (не редактировать, так как год и месяц задаются при запуске run.sh)

run.sh - bash-скрипт для запуска

Сам биллинг разбит на 5 действий: load, bill, mts, mest, local

Примеры запуска всех 5 действий для расчёта за апрель-2022 (расчёт ведётся в мае)
./run.sh 2022 4 load    // загрузка данных SMG-станции в биллинг (bill.Y2022M04)
./run.sh 2022 4 bill    // расчёт по загруженным данным
./run.sh 2022 4 mts     // формирование отчётов для выгрузки на портал МТС
./run.sh 2022 4 mest    // расчёт местной связи (есть несколько новых клиентов)
./run.sh 2022 4 local   // расчёт повремёнки (местная >450 мин) (почти нет)

в результате:
 a) created directory: ./result и ./log
 b) ./result/2022_04:
    ./result/2022_04/book   - книга счетов и Акт (акт нужен для выгрузки на портал МТС)
    ./result/2022_04/mts    - csv-файлы (поддиректория cp1251 для выгрузки на портал МТС)
    ./result/2022_04/mest   - местная связь
    ./result/2022_04/loc    - повремёнка (>450 мин) (иногда)

Для рассчёта за май-2022 запускать run.sh можно будет начиная с 1-го июня,
например:  ./run.sh 2022 5 load и так далее

Перед рассчётом нужно обязательно посмотреть исходные данные SMG. Может что-то не загрузилось.
Достаточно посмотреть распределение минут по дням месяца. В рабочие дни минут больше, в выходные меньше:
SELECT day(dt), count(*) calls, sum(min) sum_min FROM smg2.Y2022M04 GROUP BY day(dt)
